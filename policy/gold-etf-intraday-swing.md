# é»„é‡‘ETFæ—¥å†…æ³¢æ®µç­–ç•¥ Â· å®æ–½æ–¹æ¡ˆ

> 518880 é»„é‡‘ETF x ä¸ŠæœŸæ‰€AUæœŸè´§ä»·å·®å›å½’ Â· 2ä¸‡æµ‹è¯•èµ„é‡‘ Â· åŸºäº qmt-bridge åŸºå»º

---

## ä¸€ã€åŸºå»ºè¯„ä¼°ï¼šqmt-bridge èƒ½åŠ›å¯¹ç…§

### ç»“è®ºï¼šå®Œå…¨æ”¯æŒï¼Œqmt-bridge ä¸éœ€è¦ä»»ä½•æ”¹åŠ¨

ç­–ç•¥æ‰€éœ€çš„æ¯ä¸€é¡¹æ•°æ®å’Œäº¤æ˜“èƒ½åŠ›ï¼Œqmt-bridge éƒ½å·²è¦†ç›–ã€‚ç­–ç•¥ä»£ç ä½œä¸ºç‹¬ç«‹é¡¹ç›®ï¼ˆ`gold-etf-strategy/`ï¼‰ï¼Œé€šè¿‡ `QMTClient` è¿œç¨‹è°ƒç”¨å³å¯ã€‚

### æ•°æ®è·å–èƒ½åŠ›

| ç­–ç•¥éœ€æ±‚ | qmt-bridge æ¥å£ | å¤‡æ³¨ |
|---------|-----------------|------|
| AUä¸»åŠ›åˆçº¦ä»£ç  | `client.get_main_contract("AU.SHFE")` | è¿”å›å½“å‰ä¸»åŠ›åˆçº¦å¦‚ `AU2506.SHFE` |
| AUæœŸè´§å®æ—¶è¡Œæƒ… | `client.subscribe_realtime(["AU2506.SHFE"], cb, period="tick")` | WebSocket `/ws/realtime`ï¼Œtick çº§æ¨é€ |
| 518880 å®æ—¶è¡Œæƒ… | `client.subscribe_realtime(["518880.SH"], cb, period="tick")` | åŒä¸Š |
| å†å²1åˆ†é’ŸKçº¿ | `client.get_history_ex(stocks, period="1m", start_time=..., end_time=...)` | è¿”å› DataFrame |
| å†å²æ—¥çº¿ | `client.get_history_ex(stocks, period="1d", ...)` | åŒä¸Š |
| å®æ—¶å¿«ç…§ï¼ˆå•æ¬¡æŸ¥è¯¢ï¼‰ | `client.get_market_snapshot(["518880.SH", "AU2506.SHFE"])` | REST è½®è¯¢å¤‡ç”¨æ–¹æ¡ˆ |
| æ•°æ®é¢„ä¸‹è½½ | `client.download_batch(stocks, period="1m", start_time=..., end_time=...)` | æœåŠ¡ç«¯ç¼“å­˜ï¼Œåç»­è¯»å–æ›´å¿« |
| æœŸè´§å…ƒæ•°æ®ä¸‹è½½ | `client.download_futures_data()` | ä¸»åŠ›åˆçº¦æ˜ å°„ç­‰ |

### äº¤æ˜“æ‰§è¡Œèƒ½åŠ›

| ç­–ç•¥éœ€æ±‚ | qmt-bridge æ¥å£ | å¤‡æ³¨ |
|---------|-----------------|------|
| é™ä»·ä¹°å…¥/å–å‡º | `client.place_order(stock_code, order_type, volume, price_type=11, price=x)` | `order_type`: 23=ä¹°å…¥, 24=å–å‡º |
| å¼‚æ­¥ä¸‹å• | `client.place_order_async(...)` | ç»“æœé€šè¿‡ `/ws/trade` å›è°ƒ |
| æ’¤å• | `client.cancel_order(order_id)` | åŒæ­¥æ’¤å• |
| æŸ¥æŒä»“ | `client.query_positions()` / `client.query_single_position("518880.SH")` | å®ç›˜å¼•æ“ç”¨ |
| æŸ¥ä½™é¢ | `client.query_asset()` | è¿”å› cash, frozen_cash, total_asset ç­‰ |
| æŸ¥å§”æ‰˜ | `client.query_orders(cancelable_only=True)` | å¯ç­›é€‰æœªæˆäº¤ |
| æŸ¥æˆäº¤ | `client.query_trades()` | å½“æ—¥æˆäº¤æ˜ç»† |
| æˆäº¤å›æŠ¥æ¨é€ | `client.subscribe_trade_events(callback)` | WebSocket `/ws/trade`ï¼Œäº‹ä»¶ç±»å‹ï¼šorder/trade/order_error/cancel_error |

### è¾…åŠ©èƒ½åŠ›

| éœ€æ±‚ | qmt-bridge æ¥å£ | å¤‡æ³¨ |
|------|-----------------|------|
| äº¤æ˜“æ—¥å† | `client.get_trading_dates("SH", start_time, end_time)` | åˆ¤æ–­æ˜¯å¦äº¤æ˜“æ—¥ |
| æ˜¯å¦äº¤æ˜“æ—¥ | `client.is_trading_date("SH", "20260211")` | å¸ƒå°”è¿”å› |
| äº¤æ˜“æ—¶æ®µ | `client.get_trading_period("518880.SH")` | ETFä¸æœŸè´§æ—¶æ®µä¸åŒï¼Œå¯æŸ¥è¯¢ |
| åˆçº¦è¯¦æƒ… | `client.get_batch_instrument_detail(["AU2506.SHFE"])` | tickå¤§å°ç­‰ |
| èŠ‚å‡æ—¥ | `client.get_holidays()` | è‡ªåŠ¨è·³è¿‡éäº¤æ˜“æ—¥ |

### ä¸€ä¸ªä¸å½±å“çš„å·®å¼‚ï¼šæ¡ä»¶å•

qmt-bridge æœªå°è£… `order_stock_condition`ï¼ˆæ¡ä»¶å•ï¼‰ã€‚ä½†ç­–ç•¥å¼•æ“è‡ªèº«å®æ—¶ç›‘æ§ä»·æ ¼å¹¶è§¦å‘æ­¢æŸä¸‹å•ï¼Œæ—¥å†…ä¸ç•™ä»“ï¼Œä¸éœ€è¦æœåŠ¡ç«¯æ¡ä»¶å•ã€‚

---

## äºŒã€ç­–ç•¥æ¦‚è¿°

### æ ¸å¿ƒé€»è¾‘

ä¸ŠæœŸæ‰€é»„é‡‘æœŸè´§æ˜¯"å¿«æŒ‡é’ˆ"ï¼Œé»„é‡‘ETFæ˜¯"æ…¢æŒ‡é’ˆ"ã€‚ä¸¤è€…è·Ÿè¸ªåŒä¸€åº•å±‚ï¼ˆé»„é‡‘ï¼‰ï¼Œä½†æœŸè´§å¯¹ä¿¡æ¯ååº”æ›´å¿«ã€‚å½“æ—¥å†…æ¶¨è·Œå¹…å‡ºç°æ˜¾è‘—åç¦»æ—¶ï¼Œå¯¹ETFåšé«˜æŠ›ä½å¸ï¼Œèµš"æ…¢æŒ‡é’ˆè¿½ä¸Šå¿«æŒ‡é’ˆ"çš„å·®ä»·ã€‚

### ä¸ç°æœ‰ä½“ç³»çš„å…³ç³»

```
æŠ•èµ„ç­–ç•¥ä½“ç³»
â”œâ”€â”€ ä¸­çº¿åŸ‹ä¼ç­–ç•¥ï¼ˆä¸»ç­–ç•¥ï¼‰
â”œâ”€â”€ çŸ­çº¿æ‰“æ¿ç­–ç•¥ï¼ˆAI + QMT å†³ç­–æ”¯æŒï¼‰
â””â”€â”€ é»„é‡‘ETFæ—¥å†…æ³¢æ®µï¼ˆæœ¬ç­–ç•¥ï¼‰  â† ç‹¬ç«‹èµ„é‡‘æ± ï¼Œç‹¬ç«‹è®°è´¦
```

### 2ä¸‡èµ„é‡‘çš„ç°å®é¢„æœŸ

æµ‹è¯•æœŸç›®æ ‡æ˜¯**éªŒè¯ç­–ç•¥æ˜¯å¦å¯è¡Œ**ï¼Œä¸æ˜¯èµšé’±ã€‚åº•ä»“çº¦1ä¸‡ï¼ˆä¿è¯åŒå‘æ“ä½œèƒ½åŠ›ï¼‰ï¼ŒæœºåŠ¨èµ„é‡‘çº¦1ä¸‡ã€‚æ ¸å¿ƒä»·å€¼æ˜¯ç§¯ç´¯æ•°æ®ã€æ ‡å®šå‚æ•°ã€è·‘é€šé“¾è·¯ã€‚å³ä½¿ä¸€åˆ‡é¡ºåˆ©ï¼Œæœˆç›ˆåˆ©ä¹Ÿå°±å‡ ç™¾å…ƒé‡çº§ã€‚

---

## ä¸‰ã€ç³»ç»Ÿæ¶æ„

### æ•´ä½“ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            gold-etf-strategyï¼ˆMac ç‹¬ç«‹é¡¹ç›®ï¼‰          â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æ•°æ®æ¨¡å—   â”‚â†’â”‚  ç­–ç•¥å¼•æ“   â”‚â†’â”‚  æ‰§è¡Œæ¨¡å—     â”‚    â”‚
â”‚  â”‚           â”‚  â”‚           â”‚  â”‚              â”‚    â”‚
â”‚  â”‚ QMTClient â”‚  â”‚ spreadè®¡ç®— â”‚  â”‚ Simulated /  â”‚    â”‚
â”‚  â”‚ .subscribe â”‚  â”‚ ä¿¡å·ç”Ÿæˆ   â”‚  â”‚ Live Engine  â”‚    â”‚
â”‚  â”‚ _realtime  â”‚  â”‚ é£æ§æ£€æŸ¥   â”‚  â”‚              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚        â”‚                              â”‚            â”‚
â”‚   QMTClient                      QMTClient         â”‚
â”‚   (æ•°æ®API)                     (äº¤æ˜“API)           â”‚
â”‚        â”‚                              â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              è®°å½•æ¨¡å— (SQLite)               â”‚    â”‚
â”‚  â”‚  trades Â· signals Â· daily_summary Â· risk    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                     â”‚                              â”‚
â”‚                     â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           é€šçŸ¥æ¨¡å— (é£ä¹¦æœºå™¨äºº)               â”‚    â”‚
â”‚  â”‚  äº¤æ˜“é€šçŸ¥ Â· é£æ§å‘Šè­¦ Â· æ¯æ—¥æŠ¥å‘Š Â· å¼‚å¸¸å‘Šè­¦    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                     â”‚                              â”‚
â”‚              é£ä¹¦ Webhook API                       â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚        Streamlit å¯è§†åŒ–ä»ªè¡¨ç›˜                 â”‚    â”‚
â”‚  â”‚                                            â”‚    â”‚
â”‚  â”‚  ç›˜ä¸­ç›‘æ§ Â· äº¤æ˜“å¤ç›˜ Â· Spreadåˆ†æ Â·          â”‚    â”‚
â”‚  â”‚  é£æ§é¢æ¿ Â· å›æµ‹æŠ¥å‘Š Â· ç­–ç•¥å¥åº·åº¦             â”‚    â”‚
â”‚  â”‚                                            â”‚    â”‚
â”‚  â”‚  æ•°æ®æ¥æºï¼šSQLite + QMTClient(å®æ—¶)          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HTTP / WebSocket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚                qmt-bridgeï¼ˆå·²æœ‰åŸºå»ºï¼‰                  â”‚
â”‚       Windows QMT â†’ xtquant æ•°æ® + xttrader äº¤æ˜“     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡æ‹Ÿ/å®ç›˜åˆ‡æ¢

è¿™æ˜¯æ¶æ„å±‚é¢æœ€å…³é”®çš„è®¾è®¡å†³ç­–â€”â€”æ‰§è¡Œæ¨¡å—æŠ½è±¡ä¸ºç»Ÿä¸€æ¥å£ï¼Œåº•å±‚å¯ä»¥åˆ‡æ¢å®ç°ï¼š

```python
# ç»Ÿä¸€æ¥å£
class ExecutionEngine(ABC):
    def place_order(self, code, direction, volume, price) -> str: ...
    def cancel_order(self, order_id) -> bool: ...
    def get_positions(self) -> dict: ...
    def get_balance(self) -> float: ...

# æ¨¡æ‹Ÿå¼•æ“ï¼šå†…å­˜ç»´æŠ¤è™šæ‹Ÿè´¦æˆ·ï¼Œä¸è°ƒç”¨ QMTClient äº¤æ˜“æ¥å£
class SimulatedEngine(ExecutionEngine): ...

# å®ç›˜å¼•æ“ï¼šè°ƒç”¨ QMTClient.place_order / cancel_order / query_positions
class LiveEngine(ExecutionEngine):
    def __init__(self, client: QMTClient): ...
```

å¯åŠ¨æ—¶ `--mode simulated` æˆ– `--mode live` å†³å®šç”¨å“ªä¸ªå¼•æ“ã€‚ç­–ç•¥å¼•æ“ã€é£æ§ã€è®°å½•æ¨¡å—å®Œå…¨ä¸éœ€è¦æ”¹åŠ¨ã€‚

å¯ä»¥åŒæ—¶è¿è¡Œä¸¤ä¸ªå¼•æ“â€”â€”å®ç›˜æ‰§è¡ŒçœŸå®äº¤æ˜“ï¼Œæ¨¡æ‹Ÿå¼•æ“åŒæ­¥è®°å½•"å¦‚æœå‚æ•°ä¸åŒä¼šæ€æ ·"ï¼Œç”¨äºå¯¹ç…§å®éªŒã€‚

---

## å››ã€å…­ä¸ªæ ¸å¿ƒæ¨¡å—

æŒ‰å¼€å‘ä¼˜å…ˆçº§æ’åˆ—ã€‚æ¯ä¸ªæ¨¡å—å…ˆå®ç°æœ€å°å¯ç”¨ç‰ˆæœ¬ï¼Œåç»­è¿­ä»£å¢å¼ºã€‚

### æ¨¡å—ä¸€ï¼šæ•°æ®æ¨¡å—

**èŒè´£ï¼š** é€šè¿‡ QMTClient è·å–è¡Œæƒ…ï¼Œå‘ç­–ç•¥å¼•æ“æä¾›ç»Ÿä¸€æ•°æ®æµã€‚

**ç›˜å‰åˆå§‹åŒ–æµç¨‹ï¼š**
```python
client = QMTClient(host, port, api_key=api_key)

# 1. ç¡®è®¤ä»Šå¤©æ˜¯äº¤æ˜“æ—¥
if not client.is_trading_date("SH", today):
    exit("éäº¤æ˜“æ—¥ï¼Œä¸å¯åŠ¨")

# 2. è·å–AUä¸»åŠ›åˆçº¦ä»£ç ï¼ˆæ¯æ—¥æ›´æ–°ï¼Œå¤„ç†æ¢æœˆï¼‰
main_contract = client.get_main_contract("AU.SHFE")
# è¿”å›å¦‚ {"data": "AU2506.SHFE"}

# 3. æ‹‰å–ä»Šæ—¥ä¹‹å‰çš„å†å²æ•°æ®ï¼ˆç”¨äºè®¡ç®—å¼€ç›˜å‰çš„æ»šåŠ¨å‡å€¼/æ ‡å‡†å·®åŸºå‡†ï¼‰
au_hist = client.get_history_ex([main_contract], period="1m", count=240)  # å‰ä¸€æ—¥å…¨å¤©
etf_hist = client.get_history_ex(["518880.SH"], period="1m", count=240)
```

**å®æ—¶æ•°æ®è®¢é˜…ï¼š**
```python
# åŒæ—¶è®¢é˜…æœŸè´§å’ŒETFçš„tickæ•°æ®
asyncio.run(client.subscribe_realtime(
    stocks=[main_contract, "518880.SH"],
    callback=on_tick,
    period="tick",
))
```

**æ•°æ®å¤„ç†å…³é”®ç‚¹ï¼š**
- **ç”¨æ¶¨è·Œå¹…è€Œéç»å¯¹ä»·æ ¼ï¼š** `pct(t) = (price(t) - open_price) / open_price`ï¼Œé¿å…æœŸè´§æ¢æœˆä»·æ ¼è·³å˜
- **åªåœ¨é‡å äº¤æ˜“æ—¶æ®µè®¡ç®—spreadï¼š** æœŸè´§æœ‰å¤œç›˜(21:00-02:30)ï¼ŒETFæ²¡æœ‰ã€‚spreadä»…åœ¨9:30-11:30å’Œ13:00-15:00è®¡ç®—
- **äº¤æ˜“æ—¶æ®µå¯æŸ¥è¯¢ç¡®è®¤ï¼š** `client.get_trading_period("518880.SH")` è¿”å›ç¡®åˆ‡æ—¶æ®µ
- **æ•°æ®ä¸­æ–­æ£€æµ‹ï¼š** è¶…è¿‡30ç§’æ— æ–°tick â†’ æ ‡è®°æ•°æ®å¼‚å¸¸ â†’ æš‚åœä¿¡å·ç”Ÿæˆ
- **å†…å­˜æ»‘åŠ¨çª—å£ï¼š** ç»´æŠ¤æœ€è¿‘Næ ¹1åˆ†é’ŸKçº¿ï¼Œä¸è½ç›˜

**å­˜å‚¨æ–¹æ¡ˆï¼š**
- å®æ—¶æ•°æ®ï¼šå†…å­˜æ»‘åŠ¨çª—å£
- å†å²æ•°æ®ï¼šParquetæ–‡ä»¶ï¼ˆæŒ‰å“ç§+æ—¥æœŸç»„ç»‡ï¼Œå›æµ‹ç”¨ï¼‰
- ç»“æ„åŒ–æ•°æ®ï¼šSQLiteï¼ˆäº¤æ˜“æ—¥å¿—ã€ä¿¡å·è®°å½•ã€é£æ§çŠ¶æ€ï¼‰

### æ¨¡å—äºŒï¼šç­–ç•¥å¼•æ“

**æ ¸å¿ƒè®¡ç®—ï¼š**
```python
# æ—¥å†…æ¶¨è·Œå¹…
etf_pct = (etf_price - etf_open) / etf_open
au_pct = (au_price - au_open) / au_open

# ä»·å·®
spread = etf_pct - au_pct

# åç¦»åº¦ï¼ˆZ-Scoreï¼‰
z_score = (spread - rolling_mean(spread, window)) / rolling_std(spread, window)
```

**ä¿¡å·ç±»å‹ï¼š**

| ä¿¡å· | è§¦å‘æ¡ä»¶ | åŠ¨ä½œ |
|------|---------|------|
| `OPEN_LONG` | z_score < -thresholdï¼ˆETFç›¸å¯¹ä¾¿å®œï¼‰ | ä¹°å…¥ETF |
| `OPEN_SHORT` | z_score > +thresholdï¼ˆETFç›¸å¯¹è´µï¼‰ | å–å‡ºåº•ä»“ETF |
| `CLOSE` | z_scoreå›å½’åˆ°0é™„è¿‘ | å¹³æ‰æ—¥å†…ä»“ä½ |
| `STOP_LOSS` | æµ®äºè¶…é™ | æ­¢æŸå¹³ä»“ |
| `TIME_STOP` | æŒä»“è¶…æ—¶ | å¼ºåˆ¶å¹³ä»“ |
| `EOD_CLOSE` | 14:50 | å°¾ç›˜æ¸…ä»“ |

**å¾…å›æµ‹æ ‡å®šçš„å‚æ•°ï¼š** æ»šåŠ¨çª—å£é•¿åº¦ã€åç¦»åº¦é˜ˆå€¼ã€æ­¢æŸå¹…åº¦ã€æŒä»“è¶…æ—¶æ—¶é—´ã€æ—¶æ®µè¿‡æ»¤è§„åˆ™ã€‚å…ˆç”¨ç»éªŒå€¼ç¡¬ç¼–ç ï¼ŒPhase 0 å›æµ‹åè°ƒæ•´ã€‚ä¸åšå‚æ•°é…ç½®ä¸­å¿ƒï¼Œé¿å…è¿‡æ—©æŠ½è±¡ã€‚

**ç­–ç•¥å¼•æ“ä¸å…³å¿ƒæ˜¯æ¨¡æ‹Ÿè¿˜æ˜¯å®ç›˜**â€”â€”å®ƒåªç”Ÿæˆä¿¡å·ï¼Œæ‰§è¡Œç”±ä¸‹æ¸¸å¤„ç†ã€‚

### æ¨¡å—ä¸‰ï¼šæ‰§è¡Œæ¨¡å—

**æ¨¡æ‹Ÿäº¤æ˜“å¼•æ“æ ¸å¿ƒé€»è¾‘ï¼š**
```python
class SimulatedEngine(ExecutionEngine):
    def __init__(self, initial_cash=20000, fee_rate=0.00025):
        self.cash = initial_cash
        self.positions = {}  # {code: volume}
        self.trades = []
        self.fee_rate = fee_rate

    def place_order(self, code, direction, volume, price):
        slippage = 0.001 if direction == "buy" else -0.001  # æ¨¡æ‹Ÿ1ä¸ªtickæ»‘ç‚¹
        exec_price = price * (1 + slippage)
        cost = exec_price * volume
        fee = cost * self.fee_rate

        if direction == "buy":
            self.cash -= (cost + fee)
            self.positions[code] = self.positions.get(code, 0) + volume
        else:
            self.cash += (cost - fee)
            self.positions[code] = self.positions.get(code, 0) - volume

        # ç”Ÿæˆ trade recordï¼Œå†™å…¥ SQLite
        ...
```

**å®ç›˜äº¤æ˜“å¼•æ“æ ¸å¿ƒé€»è¾‘ï¼š**
```python
class LiveEngine(ExecutionEngine):
    def __init__(self, client: QMTClient):
        self.client = client

    def place_order(self, code, direction, volume, price):
        order_type = 23 if direction == "buy" else 24
        result = self.client.place_order(
            stock_code=code,
            order_type=order_type,
            order_volume=volume,
            price_type=11,    # é™ä»·
            price=price,
            strategy_name="gold_etf_swing",
        )
        return result

    def cancel_order(self, order_id):
        return self.client.cancel_order(order_id)

    def get_positions(self):
        return self.client.query_positions()

    def get_balance(self):
        asset = self.client.query_asset()
        return asset.get("cash", 0)

    # å¼‚æ­¥ä¸‹å• + æˆäº¤å›æŠ¥ç›‘å¬ï¼ˆPhase 3 å¢å¼ºï¼‰
    async def place_order_and_monitor(self, code, direction, volume, price):
        result = self.client.place_order_async(...)
        # é€šè¿‡ subscribe_trade_events ç›‘å¬æˆäº¤å›æŠ¥
        # è¶…æ—¶æœªæˆäº¤ â†’ æ’¤å•
```

### æ¨¡å—å››ï¼šè®°å½•æ¨¡å—

**èŒè´£ï¼š** è®°å½•ä¸€åˆ‡ï¼Œè®©æ¯ä¸€ç¬”äº¤æ˜“å’Œæ¯ä¸€ä¸ªä¿¡å·éƒ½å¯è¿½æº¯å¯åˆ†æã€‚

**è¿™ä¸ªæ¨¡å—çš„é‡è¦æ€§ç­‰åŒäºç­–ç•¥æœ¬èº«**â€”â€”æ²¡æœ‰å®Œæ•´çš„è®°å½•ï¼Œæ‰€æœ‰çš„å›æµ‹å’Œä¼˜åŒ–éƒ½æ˜¯ç©ºä¸­æ¥¼é˜ã€‚

**SQLite è¡¨ç»“æ„ï¼š**

```sql
-- æ¯ç¬”æˆäº¤
CREATE TABLE trades (
    trade_id TEXT PRIMARY KEY,
    timestamp TEXT NOT NULL,
    code TEXT NOT NULL,
    direction TEXT NOT NULL,  -- buy/sell
    volume INTEGER NOT NULL,
    price REAL NOT NULL,
    fee REAL DEFAULT 0,
    mode TEXT NOT NULL,  -- simulated/live
    signal_id TEXT,
    spread_at_entry REAL,
    spread_at_exit REAL,
    pnl REAL,
    hold_duration_seconds INTEGER,
    exit_reason TEXT  -- reversion/stop_loss/time_stop/eod/risk
);

-- æ¯ä¸ªä¿¡å·ï¼ˆå«æœªæ‰§è¡Œçš„ï¼‰
CREATE TABLE signals (
    signal_id TEXT PRIMARY KEY,
    timestamp TEXT NOT NULL,
    signal_type TEXT NOT NULL,
    spread_value REAL,
    z_score REAL,
    au_price REAL,
    etf_price REAL,
    au_pct REAL,
    etf_pct REAL,
    executed INTEGER DEFAULT 0,
    skip_reason TEXT,
    market_snapshot TEXT  -- JSON: å½“æ—¶çš„å¸‚åœºçŠ¶æ€å¿«ç…§
);

-- æ¯æ—¥æ±‡æ€»
CREATE TABLE daily_summary (
    date TEXT PRIMARY KEY,
    mode TEXT,
    total_trades INTEGER DEFAULT 0,
    win_count INTEGER DEFAULT 0,
    loss_count INTEGER DEFAULT 0,
    total_pnl REAL DEFAULT 0,
    max_single_loss REAL DEFAULT 0,
    win_rate REAL DEFAULT 0,
    signals_generated INTEGER DEFAULT 0,
    signals_executed INTEGER DEFAULT 0,
    signals_skipped INTEGER DEFAULT 0,
    risk_events_json TEXT  -- JSON array
);

-- é£æ§è§¦å‘è®°å½•
CREATE TABLE risk_events (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp TEXT NOT NULL,
    rule_name TEXT NOT NULL,
    trigger_value REAL,
    threshold REAL,
    action_taken TEXT
);
```

**ä¸ºä»€ä¹ˆè®°å½•æœªæ‰§è¡Œçš„ä¿¡å·ï¼š** è¿™æ˜¯åç»­ä¼˜åŒ–çš„é‡‘çŸ¿ã€‚å¯èƒ½å‘ç°"è¢«é£æ§è¿‡æ»¤æ‰çš„ä¿¡å·å…¶å®èƒœç‡å¾ˆé«˜"æˆ–"æŸä¸ªæ—¶æ®µçš„ä¿¡å·å…¨æ˜¯å‡ä¿¡å·"â€”â€”è¿™äº›æ´å¯Ÿåªæœ‰åœ¨å®Œæ•´è®°å½•äº†æ‰€æœ‰ä¿¡å·åæ‰èƒ½è·å¾—ã€‚

### æ¨¡å—äº”ï¼šé€šçŸ¥æ¨¡å—ï¼ˆé£ä¹¦æœºå™¨äººï¼‰

**èŒè´£ï¼š** å°†ç­–ç•¥å…³é”®äº‹ä»¶å®æ—¶æ¨é€åˆ°é£ä¹¦ï¼Œè®©äººä¸ç›¯ç›˜ä¹Ÿèƒ½æŒæ¡ç­–ç•¥è¿è¡ŒçŠ¶æ€ã€‚

**å®ç°æ–¹å¼ï¼š** é£ä¹¦è‡ªå®šä¹‰æœºå™¨äºº Webhookï¼ˆPOST JSON åˆ° webhook URLï¼‰ï¼Œé›¶ä¾èµ–ï¼ˆstdlib `urllib` å³å¯ï¼‰ï¼Œæ— éœ€é£ä¹¦ SDKã€‚

**é€šçŸ¥äº‹ä»¶åˆ†çº§ï¼š**

| çº§åˆ« | äº‹ä»¶ | æ¨é€æ—¶æœº | æ¶ˆæ¯å†…å®¹ |
|------|------|---------|---------|
| **äº¤æ˜“é€šçŸ¥** | å¼€ä»“æˆäº¤ | æ¯ç¬”æˆäº¤å | æ–¹å‘ã€ä»·æ ¼ã€æ•°é‡ã€spreadå€¼ã€z_score |
| **äº¤æ˜“é€šçŸ¥** | å¹³ä»“æˆäº¤ | æ¯ç¬”å¹³ä»“å | æ–¹å‘ã€ä»·æ ¼ã€ç›ˆäºé‡‘é¢ã€æŒä»“æ—¶é•¿ã€å¹³ä»“åŸå›  |
| **é£æ§å‘Šè­¦** | æ­¢æŸè§¦å‘ | æ­¢æŸå¹³ä»“å | äºæŸé‡‘é¢ã€è§¦å‘è§„åˆ™ã€å½“æ—¥ç´¯è®¡äºæŸ |
| **é£æ§å‘Šè­¦** | æ—¥å†…ç†”æ–­ | è§¦å‘æ—¶ | ç†”æ–­åŸå› ï¼ˆè¿äº/å•æ—¥äºæŸä¸Šé™ï¼‰ã€å½“æ—¥ç»Ÿè®¡ |
| **é£æ§å‘Šè­¦** | ç­–ç•¥çº§ç†”æ–­ | è§¦å‘æ—¶ | ç´¯è®¡äºæŸã€ç†”æ–­çº¿ã€ç­–ç•¥å·²åœæ­¢ |
| **æ¯æ—¥æŠ¥å‘Š** | æ”¶ç›˜æ±‡æ€» | 15:05 | å½“æ—¥äº¤æ˜“ç¬”æ•°ã€èƒœç‡ã€ç›ˆäºã€æŒä»“çŠ¶æ€ |
| **ç³»ç»Ÿå‘Šè­¦** | æ•°æ®ä¸­æ–­ | æ£€æµ‹åˆ°æ—¶ | ä¸­æ–­æ—¶é•¿ã€å½±å“å“ç§ã€æ˜¯å¦æš‚åœä¿¡å· |
| **ç³»ç»Ÿå‘Šè­¦** | ç­–ç•¥å¯åŠ¨/åœæ­¢ | å¯åœæ—¶ | è¿è¡Œæ¨¡å¼ã€ä¸»åŠ›åˆçº¦ä»£ç ã€åˆå§‹æŒä»“ |
| **ç³»ç»Ÿå‘Šè­¦** | ä¸‹å•å¤±è´¥ | å¤±è´¥æ—¶ | é”™è¯¯ä¿¡æ¯ã€å¤±è´¥è®¢å•è¯¦æƒ… |

**é£ä¹¦æ¶ˆæ¯æ ¼å¼ï¼š** ä½¿ç”¨å¯Œæ–‡æœ¬å¡ç‰‡ï¼ˆInteractive Cardï¼‰ï¼Œç»“æ„æ¸…æ™°æ˜“è¯»ã€‚

```python
import json
import urllib.request
import time
import hmac
import hashlib
import base64


class FeishuNotifier:
    """é£ä¹¦æœºå™¨äººé€šçŸ¥å™¨ã€‚"""

    def __init__(self, webhook_url: str, secret: str = ""):
        self.webhook_url = webhook_url
        self.secret = secret

    def _sign(self) -> tuple[str, str]:
        """ç”Ÿæˆç­¾åï¼ˆv2 å®‰å…¨æ ¡éªŒï¼‰ã€‚"""
        timestamp = str(int(time.time()))
        string_to_sign = f"{timestamp}\n{self.secret}"
        hmac_code = hmac.new(
            string_to_sign.encode(), digestmod=hashlib.sha256
        ).digest()
        sign = base64.b64encode(hmac_code).decode()
        return timestamp, sign

    def send(self, title: str, content: list[list[dict]]):
        """å‘é€å¯Œæ–‡æœ¬æ¶ˆæ¯ã€‚"""
        msg = {
            "msg_type": "post",
            "content": {
                "post": {
                    "zh_cn": {
                        "title": title,
                        "content": content,
                    }
                }
            },
        }
        if self.secret:
            ts, sign = self._sign()
            msg["timestamp"] = ts
            msg["sign"] = sign

        data = json.dumps(msg).encode()
        req = urllib.request.Request(
            self.webhook_url,
            data=data,
            headers={"Content-Type": "application/json"},
        )
        urllib.request.urlopen(req)

    # â”€â”€ ä¾¿æ·æ–¹æ³• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    def notify_trade(self, direction, code, price, volume, spread, z_score, pnl=None):
        """äº¤æ˜“æˆäº¤é€šçŸ¥ã€‚"""
        action = "ä¹°å…¥" if direction == "buy" else "å–å‡º"
        lines = [
            [{"tag": "text", "text": f"{action} {code}  {volume}è‚¡ @ {price:.3f}"}],
            [{"tag": "text", "text": f"Spread: {spread:.4f}  Z-Score: {z_score:.2f}"}],
        ]
        if pnl is not None:
            emoji = "+" if pnl >= 0 else ""
            lines.append([{"tag": "text", "text": f"æœ¬ç¬”ç›ˆäº: {emoji}{pnl:.2f}å…ƒ"}])
        self.send(f"{'ğŸŸ¢' if direction == 'buy' else 'ğŸ”´'} {action}æˆäº¤", lines)

    def notify_risk_alert(self, rule_name, trigger_value, threshold, action_taken):
        """é£æ§å‘Šè­¦é€šçŸ¥ã€‚"""
        self.send("âš ï¸ é£æ§å‘Šè­¦", [
            [{"tag": "text", "text": f"è§¦å‘è§„åˆ™: {rule_name}"}],
            [{"tag": "text", "text": f"è§¦å‘å€¼: {trigger_value:.4f}  é˜ˆå€¼: {threshold:.4f}"}],
            [{"tag": "text", "text": f"æ‰§è¡ŒåŠ¨ä½œ: {action_taken}"}],
        ])

    def notify_daily_summary(self, date, trades, wins, losses, pnl, win_rate):
        """æ¯æ—¥æ”¶ç›˜æ±‡æ€»ã€‚"""
        emoji = "ğŸ“ˆ" if pnl >= 0 else "ğŸ“‰"
        self.send(f"{emoji} {date} æ”¶ç›˜æ±‡æ€»", [
            [{"tag": "text", "text": f"äº¤æ˜“: {trades}ç¬”  èƒœ: {wins}  è´Ÿ: {losses}"}],
            [{"tag": "text", "text": f"èƒœç‡: {win_rate:.1%}  ç›ˆäº: {'+' if pnl >= 0 else ''}{pnl:.2f}å…ƒ"}],
        ])

    def notify_system(self, event, detail):
        """ç³»ç»Ÿäº‹ä»¶é€šçŸ¥ï¼ˆå¯åœã€å¼‚å¸¸ç­‰ï¼‰ã€‚"""
        self.send(f"ğŸ”§ {event}", [
            [{"tag": "text", "text": detail}],
        ])
```

**é˜²åˆ·æ§åˆ¶ï¼š**
- åŒç±»é€šçŸ¥æœ€çŸ­é—´éš”60ç§’ï¼ˆé¿å…è¡Œæƒ…å‰§çƒˆæ³¢åŠ¨æ—¶åˆ·å±ï¼‰
- æ•°æ®ä¸­æ–­å‘Šè­¦ï¼šé¦–æ¬¡å‘Šè­¦åï¼Œæ¢å¤æ—¶å†å‘ä¸€æ¡ï¼Œä¸­é—´ä¸é‡å¤
- æ¯æ—¥é€šçŸ¥ä¸Šé™ï¼ˆå¦‚50æ¡ï¼‰ï¼Œè¶…é™ååªå‘é£æ§å‘Šè­¦å’Œæ”¶ç›˜æ±‡æ€»

**é…ç½®ï¼š**
```python
# config.py
FEISHU_WEBHOOK_URL = "https://open.feishu.cn/open-apis/bot/v2/hook/xxxxx"
FEISHU_WEBHOOK_SECRET = ""  # å¯é€‰ï¼Œé£ä¹¦æœºå™¨äººç­¾åå¯†é’¥
NOTIFY_ENABLED = True
NOTIFY_TRADE = True       # æ˜¯å¦æ¨é€æ¯ç¬”æˆäº¤
NOTIFY_RISK = True        # æ˜¯å¦æ¨é€é£æ§å‘Šè­¦ï¼ˆå»ºè®®å§‹ç»ˆå¼€å¯ï¼‰
NOTIFY_DAILY = True       # æ˜¯å¦æ¨é€æ¯æ—¥æ±‡æ€»
NOTIFY_SYSTEM = True      # æ˜¯å¦æ¨é€ç³»ç»Ÿäº‹ä»¶
```

### æ¨¡å—å…­ï¼šå¯è§†åŒ–ä»ªè¡¨ç›˜ï¼ˆStreamlitï¼‰

**èŒè´£ï¼š** å°†ç­–ç•¥è¿è¡Œçš„å…¨è¿‡ç¨‹â€”â€”ä»å®æ—¶è¡Œæƒ…åˆ°å†å²å¤ç›˜â€”â€”å˜æˆå¯äº¤äº’çš„å¯è§†åŒ–ç•Œé¢ã€‚ç›˜ä¸­ç”¨æ¥ç›‘æ§ï¼Œç›˜åç”¨æ¥åˆ†æä¼˜åŒ–ã€‚

**ä¸ºä»€ä¹ˆç”¨ Streamlitï¼š**
- çº¯ Pythonï¼Œä¸å†™å‰ç«¯ä»£ç ï¼Œä¸ç­–ç•¥é¡¹ç›®çš„ pandas/numpy ç”Ÿæ€æ— ç¼è¡”æ¥
- å†…ç½® `st.plotly_chart` / `st.altair_chart` æ”¯æŒäº¤äº’å¼å›¾è¡¨
- å¤šé¡µé¢åº”ç”¨ï¼ˆ`st.navigation`ï¼‰ï¼Œæ¯ä¸ªåˆ†æç»´åº¦ä¸€ä¸ªé¡µé¢
- `st_autorefresh` ç»„ä»¶æ”¯æŒç›˜ä¸­å®šæ—¶åˆ·æ–°

**æ•°æ®æ¥æºï¼š**
- å†å²/äº¤æ˜“æ•°æ®ï¼šè¯» SQLiteï¼ˆtrades, signals, daily_summary, risk_events è¡¨ï¼‰
- å®æ—¶æ•°æ®ï¼šè°ƒ QMTClient å¿«ç…§æ¥å£ï¼ˆ`get_market_snapshot`ï¼‰ï¼Œæˆ–è¯»ç­–ç•¥å¼•æ“å†™å…¥çš„å†…å­˜/ä¸´æ—¶æ–‡ä»¶
- å›æµ‹æ•°æ®ï¼šè¯» Parquet + å›æµ‹ç»“æœ JSON/CSV

---

#### é¡µé¢ä¸€ï¼šç›˜ä¸­ç›‘æ§ï¼ˆDashboardï¼‰

ç›˜ä¸­æœ€æ ¸å¿ƒçš„ä¸€å±ï¼Œç›®æ ‡æ˜¯**ä¸€çœ¼çœ‹æ¸…ç­–ç•¥å½“å‰çŠ¶æ€**ã€‚

**é¡¶éƒ¨çŠ¶æ€æ ï¼ˆMetricsï¼‰ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿è¡Œæ¨¡å¼  â”‚ â”‚ å½“æ—¥ç›ˆäº  â”‚ â”‚ å½“æ—¥äº¤æ˜“  â”‚ â”‚ å½“å‰æŒä»“  â”‚ â”‚ ç­–ç•¥çŠ¶æ€  â”‚
â”‚ æ¨¡æ‹Ÿ/å®ç›˜ â”‚ â”‚ +12.50å…ƒ  â”‚ â”‚  3ç¬”/2èƒœ  â”‚ â”‚ 500è‚¡    â”‚ â”‚ è¿è¡Œä¸­    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒå›¾è¡¨åŒºï¼ˆä¸Šä¸‹ä¸¤æ ï¼‰ï¼š**

**å›¾è¡¨1ï¼šSpread å®æ—¶èµ°åŠ¿ï¼ˆä¸»å›¾ï¼‰**
- Xè½´ï¼šæ—¥å†…æ—¶é—´ï¼ˆ9:30~15:00ï¼‰
- Yè½´ï¼šspread å€¼
- å åŠ å±‚ï¼š
  - spread å®æ—¶æ›²çº¿
  - æ»šåŠ¨å‡å€¼çº¿
  - Â±1Ïƒ / Â±2Ïƒ é€šé“å¸¦ï¼ˆåŠé€æ˜å¡«å……ï¼‰
  - ä¹°å…¥ä¿¡å·æ ‡è®°ï¼ˆç»¿è‰²ä¸‰è§’ â–²ï¼‰
  - å–å‡ºä¿¡å·æ ‡è®°ï¼ˆçº¢è‰²ä¸‰è§’ â–¼ï¼‰
  - å½“å‰æŒä»“åŒºé—´ï¼ˆæµ…è‰²èƒŒæ™¯æ ‡è®°ä»å¼€ä»“åˆ°ç°åœ¨çš„æ—¶é—´æ®µï¼‰
- å®ç°ï¼šPlotlyï¼ˆæ”¯æŒæ‚¬æµ®æŸ¥çœ‹å…·ä½“æ•°å€¼ï¼‰

**å›¾è¡¨2ï¼šETF vs æœŸè´§æ—¥å†…æ¶¨è·Œå¹…å¯¹æ¯”**
- åŒçº¿å åŠ ï¼šETF æ—¥å†…æ¶¨è·Œå¹… vs AU æœŸè´§æ—¥å†…æ¶¨è·Œå¹…
- å¡«å……ä¸¤æ¡çº¿ä¹‹é—´çš„å·®å€¼åŒºåŸŸï¼ˆspread > 0 å¡«çº¢ï¼Œspread < 0 å¡«ç»¿ï¼‰
- ç›´è§‚å±•ç¤º"è°é¢†å…ˆè°"

**å³ä¾§ä¿¡æ¯é¢æ¿ï¼š**

```
â”Œâ”€ å®æ—¶æŠ¥ä»· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 518880   6.521 +0.12%  â”‚
â”‚ AU2506  658.30 +0.25%  â”‚
â”‚ Spread   -0.0013       â”‚
â”‚ Z-Score  -1.82         â”‚
â”œâ”€ å½“å‰æŒä»“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 518880   500è‚¡         â”‚
â”‚ æˆæœ¬     6.515         â”‚
â”‚ æµ®ç›ˆ     +3.00å…ƒ       â”‚
â”‚ æŒä»“æ—¶é•¿  12åˆ†é’Ÿ        â”‚
â”œâ”€ ä»Šæ—¥ä¿¡å· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10:23 OPEN_LONG  å·²æ‰§è¡Œ â”‚
â”‚ 10:45 CLOSE      å·²æ‰§è¡Œ â”‚
â”‚ 11:02 OPEN_SHORT è·³è¿‡   â”‚
â”‚ 13:15 OPEN_LONG  å·²æ‰§è¡Œ â”‚
â”œâ”€ é£æ§çŠ¶æ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ—¥äºä¸Šé™  â–ˆâ–ˆâ–‘â–‘â–‘ 40%    â”‚
â”‚ äº¤æ˜“ç¬”æ•°  â–ˆâ–ˆâ–ˆâ–‘â–‘ 60%    â”‚
â”‚ è¿ç»­äºæŸ  â–ˆâ–‘â–‘â–‘â–‘ 20%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è‡ªåŠ¨åˆ·æ–°ï¼š** æ¯10ç§’åˆ·æ–°ä¸€æ¬¡ï¼ˆ`st_autorefresh(interval=10000)`ï¼‰ï¼Œç›˜ä¸­æ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

---

#### é¡µé¢äºŒï¼šäº¤æ˜“å¤ç›˜

ç›˜åå¤ç›˜çš„æ ¸å¿ƒå·¥å…·ï¼Œå›ç­”"ä»Šå¤©åšå¾—æ€ä¹ˆæ ·ã€ä¸ºä»€ä¹ˆ"ã€‚

**æ—¥æœŸé€‰æ‹©å™¨ï¼š** é¡¶éƒ¨æ—¥æœŸ/æ—¥æœŸèŒƒå›´é€‰æ‹©ã€‚

**å›¾è¡¨1ï¼šç´¯è®¡ç›ˆäºæ›²çº¿**
- Xè½´ï¼šæ—¶é—´ï¼ˆæŒ‰å¤©æˆ–æŒ‰ç¬”ï¼‰
- Yè½´ï¼šç´¯è®¡ PnLï¼ˆå…ƒï¼‰
- é™„åŠ ï¼šæœ€å¤§å›æ’¤åŒºé—´é«˜äº®æ ‡è®°
- å¯åˆ‡æ¢è§†è§’ï¼šæŒ‰æ—¥æ±‡æ€» / æŒ‰ç¬”é€æ­¥ç´¯åŠ 

**å›¾è¡¨2ï¼šæ¯æ—¥ç›ˆäºæŸ±çŠ¶å›¾**
- Xè½´ï¼šæ—¥æœŸ
- Yè½´ï¼šå½“æ—¥ PnL
- é¢œè‰²ï¼šç›ˆåˆ©ç»¿è‰²ï¼ŒäºæŸçº¢è‰²
- å åŠ ï¼šæ»šåŠ¨èƒœç‡æŠ˜çº¿ï¼ˆå³Yè½´ï¼‰

**å›¾è¡¨3ï¼šå•ç¬”ç›ˆäºåˆ†å¸ƒ**
- ç›´æ–¹å›¾ï¼šæ¯ç¬” PnL çš„åˆ†å¸ƒ
- æ ‡æ³¨å‡å€¼ã€ä¸­ä½æ•°
- å¯ä»¥ç›´è§‚çœ‹å‡º"ç›ˆåˆ©ç¬”å¹³å‡èµšå¤šå°‘ï¼ŒäºæŸç¬”å¹³å‡äºå¤šå°‘"â€”â€”ç›ˆäºæ¯”

**å›¾è¡¨4ï¼šæŒä»“æ—¶é•¿ vs ç›ˆäºæ•£ç‚¹å›¾**
- Xè½´ï¼šæŒä»“æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
- Yè½´ï¼šå•ç¬” PnL
- é¢œè‰²ï¼šæŒ‰å¹³ä»“åŸå› ç€è‰²ï¼ˆå›å½’/æ­¢æŸ/è¶…æ—¶/å°¾ç›˜ï¼‰
- æ´å¯Ÿï¼šæŒä»“å¤šä¹…èµšé’±æ¦‚ç‡æœ€é«˜ï¼Ÿè¶…æ—¶å¹³ä»“çš„æ˜¯ä¸æ˜¯éƒ½äºï¼Ÿ

**å›¾è¡¨5ï¼šå¹³ä»“åŸå› åˆ†å¸ƒ**
- é¥¼å›¾ / ç¯å½¢å›¾
- åˆ†ç±»ï¼šspreadå›å½’ã€æ­¢æŸã€è¶…æ—¶ã€å°¾ç›˜æ¸…ä»“ã€é£æ§è§¦å‘
- å æ¯”ç›´è§‚ï¼šç†æƒ³çŠ¶æ€æ˜¯"å›å½’"å ç»å¤§å¤šæ•°

**äº¤æ˜“æ˜ç»†è¡¨ï¼š**
- å¯æ’åºã€å¯ç­›é€‰çš„è¡¨æ ¼
- åˆ—ï¼šæ—¶é—´ã€æ–¹å‘ã€ä»·æ ¼ã€æ•°é‡ã€å¼€ä»“spreadã€å¹³ä»“spreadã€ç›ˆäºã€æŒä»“æ—¶é•¿ã€å¹³ä»“åŸå› 
- ç‚¹å‡»æŸè¡Œå¯å±•å¼€è¯¦æƒ…ï¼ˆå¼€ä»“æ—¶çš„å¸‚åœºå¿«ç…§ï¼‰

---

#### é¡µé¢ä¸‰ï¼šSpread æ·±åº¦åˆ†æ

ç­–ç•¥çš„æ ¹åŸºæ˜¯ spread çš„ç»Ÿè®¡ç‰¹æ€§ï¼Œè¿™ä¸ªé¡µé¢æŠŠ spread ç¿»ä¸ªåº•æœå¤©ã€‚

**å›¾è¡¨1ï¼šSpread æ—¥å†…åˆ†æ—¶çƒ­åŠ›å›¾**
- Xè½´ï¼šæ—¥å†…æ—¶é—´æ®µï¼ˆæ¯30åˆ†é’Ÿä¸€ä¸ªæ¡¶ï¼‰
- Yè½´ï¼šæ—¥æœŸ
- é¢œè‰²ï¼šspread å‡å€¼æˆ–æ³¢åŠ¨ç‡
- æ´å¯Ÿï¼šå“ªä¸ªæ—¶æ®µ spread æ³¢åŠ¨æœ€å¤§ï¼Ÿæ˜¯å¦æœ‰ç¨³å®šçš„æ—¥å†…è§„å¾‹ï¼Ÿ

**å›¾è¡¨2ï¼šSpread åˆ†å¸ƒç›´æ–¹å›¾**
- å…¨é‡ spread å€¼çš„é¢‘ç‡åˆ†å¸ƒ
- å åŠ æ­£æ€åˆ†å¸ƒæ‹Ÿåˆæ›²çº¿
- æ ‡æ³¨å‡å€¼ã€æ ‡å‡†å·®ã€ååº¦ã€å³°åº¦
- å¯æŒ‰æ—¶æ®µç­›é€‰ï¼ˆæ—©ç›˜ vs åˆç›˜ï¼‰

**å›¾è¡¨3ï¼šSpread è‡ªç›¸å…³å›¾ï¼ˆACFï¼‰**
- å±•ç¤º spread çš„è‡ªç›¸å…³ç»“æ„
- å¦‚æœçŸ­lagè‡ªç›¸å…³æ˜¾è‘—ä¸ºæ­£ â†’ è¶‹åŠ¿æ€§ï¼›æ˜¾è‘—ä¸ºè´Ÿ â†’ å‡å€¼å›å¤
- è¿™æ˜¯ç­–ç•¥æˆç«‹çš„ç»Ÿè®¡å­¦åŸºç¡€

**å›¾è¡¨4ï¼šå›å½’é€Ÿåº¦åˆ†æ**
- Xè½´ï¼šåç¦»ç¨‹åº¦ï¼ˆ|z_score| åˆ†æ¡¶ï¼š1~1.5Ïƒ, 1.5~2Ïƒ, 2~2.5Ïƒ, >2.5Ïƒï¼‰
- Yè½´ï¼šå›å½’åˆ° 0.5Ïƒ ä»¥å†…çš„å¹³å‡æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
- æ´å¯Ÿï¼šåç¦»è¶Šå¤§å›å½’è¶Šå¿«å—ï¼Ÿå¤šå¤§çš„åç¦»æ‰å€¼å¾—äº¤æ˜“ï¼Ÿ

**å›¾è¡¨5ï¼šSpread vs é»„é‡‘ä»·æ ¼æ³¢åŠ¨å…³ç³»**
- æ•£ç‚¹å›¾ï¼šAUæ—¥å†…æ³¢å¹…ï¼ˆhigh-lowï¼‰vs spread æ ‡å‡†å·®
- æ´å¯Ÿï¼šé»„é‡‘å¤§æ¶¨å¤§è·Œçš„æ—¥å­ï¼Œspread æ˜¯æ›´å¤§è¿˜æ˜¯æ›´å°ï¼Ÿç­–ç•¥é€‚åˆå“ªç§å¸‚åœºç¯å¢ƒï¼Ÿ

**å›¾è¡¨6ï¼šåˆçº¦æ¢æœˆå½±å“åˆ†æ**
- æ—¶é—´çº¿æ ‡æ³¨æ¢æœˆæ—¥æœŸ
- æ¢æœˆå‰å spread è¡Œä¸ºæ˜¯å¦å¼‚å¸¸
- å¸®åŠ©å†³å®šæ¢æœˆæ—¥æ˜¯å¦éœ€è¦åœç­–ç•¥

---

#### é¡µé¢å››ï¼šé£æ§é¢æ¿

é£æ§ä¸æ˜¯"è®¾äº†å°±å¿˜"çš„ä¸œè¥¿ï¼Œéœ€è¦æŒç»­ç›‘æ§å’Œæ ¡å‡†ã€‚

**é¡¶éƒ¨æŒ‡æ ‡å¡ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç´¯è®¡ç›ˆäº  â”‚ â”‚ æœ€å¤§å›æ’¤  â”‚ â”‚ è·ç†”æ–­çº¿  â”‚ â”‚ æ»šåŠ¨èƒœç‡  â”‚
â”‚ +156.00  â”‚ â”‚ -89.00   â”‚ â”‚ è¿˜å‰©911å…ƒ â”‚ â”‚ 58.3%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å›¾è¡¨1ï¼šé£æ§äº‹ä»¶æ—¶é—´çº¿**
- æ—¶é—´è½´å±•ç¤ºæ‰€æœ‰é£æ§è§¦å‘äº‹ä»¶
- æŒ‰è§„åˆ™ç±»å‹ç€è‰²ï¼ˆæ­¢æŸ/ç†”æ–­/è¶…é™/...ï¼‰
- ç‚¹å‡»æŸ¥çœ‹è§¦å‘æ—¶çš„è¯¦ç»†ä¸Šä¸‹æ–‡

**å›¾è¡¨2ï¼šæ¯æ—¥é£æ§è§¦å‘ç»Ÿè®¡**
- å †å æŸ±çŠ¶å›¾ï¼šæ¯å¤©å„ç±»é£æ§è§„åˆ™çš„è§¦å‘æ¬¡æ•°
- æ´å¯Ÿï¼šé£æ§æ˜¯è¶Šæ¥è¶Šå°‘è§¦å‘ï¼ˆç­–ç•¥åœ¨æ”¶æ•›ï¼‰è¿˜æ˜¯è¶Šæ¥è¶Šå¤šï¼ˆç­–ç•¥åœ¨å¤±æ•ˆï¼‰ï¼Ÿ

**å›¾è¡¨3ï¼šæ­¢æŸ vs éæ­¢æŸäº¤æ˜“å¯¹æ¯”**
- åˆ†ç»„æŸ±çŠ¶å›¾ï¼šæ­¢æŸäº¤æ˜“ vs æ­£å¸¸å¹³ä»“äº¤æ˜“çš„æ•°é‡å’Œå¹³å‡äºæŸ
- æ´å¯Ÿï¼šæ­¢æŸçº¿è®¾å¾—åˆä¸åˆç†ï¼Ÿæ­¢æŸåè¡Œæƒ…æ˜¯å¦ç»§ç»­æ¶åŒ–ï¼ˆéªŒè¯æ­¢æŸçš„å¿…è¦æ€§ï¼‰ï¼Ÿ

**å›¾è¡¨4ï¼šä¿¡å·è¿‡æ»¤åˆ†æ**
- è¢«é£æ§è·³è¿‡çš„ä¿¡å· vs è¢«æ‰§è¡Œçš„ä¿¡å·ï¼Œå¦‚æœéƒ½æ‰§è¡Œäº†ä¼šæ€æ ·ï¼Ÿ
- æ•°æ®æ¥æºï¼šsignals è¡¨ä¸­ `executed=0` çš„è®°å½•
- ç”¨è™šæ‹Ÿå›æµ‹ä¼°ç®—è¢«è·³è¿‡ä¿¡å·çš„"å¦‚æœç›ˆäº"
- æ´å¯Ÿï¼šé£æ§åˆ°åº•æ˜¯ä¿æŠ¤äº†ä½ è¿˜æ˜¯è¯¯æ€äº†å¥½æœºä¼šï¼Ÿ

**å›¾è¡¨5ï¼šèµ„é‡‘æ›²çº¿ + å›æ’¤å›¾**
- ä¸Šå›¾ï¼šè´¦æˆ·å‡€å€¼æ›²çº¿
- ä¸‹å›¾ï¼šå›æ’¤ç™¾åˆ†æ¯”æ›²çº¿
- æ ‡æ³¨æœ€å¤§å›æ’¤çš„èµ·æ­¢æ—¥æœŸ
- å åŠ ç†”æ–­çº¿æ°´å¹³è™šçº¿

---

#### é¡µé¢äº”ï¼šå›æµ‹æŠ¥å‘Š

Phase 0 å›æµ‹ç»“æœçš„å¯è§†åŒ–å±•ç¤ºï¼Œä¹Ÿæ”¯æŒåç»­é‡æ–°å›æµ‹åæ›´æ–°ã€‚

**å‚æ•°é¢æ¿ï¼ˆä¾§è¾¹æ ï¼‰ï¼š**
- æ»šåŠ¨çª—å£é•¿åº¦ï¼šæ»‘å—
- Z-Score é˜ˆå€¼ï¼šæ»‘å—
- æ­¢æŸæ¯”ä¾‹ï¼šæ»‘å—
- æŒä»“è¶…æ—¶ï¼šæ»‘å—
- ç‚¹å‡»"è¿è¡Œå›æµ‹"é‡æ–°è®¡ç®—

**å›¾è¡¨1ï¼šå›æµ‹æƒç›Šæ›²çº¿**
- ç­–ç•¥å‡€å€¼ vs ä¹°å…¥æŒæœ‰518880 vs 0åŸºå‡†çº¿
- æ ‡æ³¨æœ€å¤§å›æ’¤åŒºé—´

**å›¾è¡¨2ï¼šæœˆåº¦æ”¶ç›Šçƒ­åŠ›å›¾**
- Xè½´ï¼šæœˆä»½
- Yè½´ï¼šå¹´ä»½ï¼ˆå¦‚æœæ•°æ®è·¨å¹´ï¼‰
- é¢œè‰²ï¼šæœˆåº¦æ”¶ç›Šç‡
- ç±»ä¼¼é‡åŒ–åŸºé‡‘çš„æœˆåº¦æ”¶ç›Šå±•ç¤º

**å›¾è¡¨3ï¼šå‚æ•°æ•æ„Ÿæ€§çƒ­åŠ›å›¾**
- Xè½´ï¼šZ-Score é˜ˆå€¼
- Yè½´ï¼šæ»šåŠ¨çª—å£é•¿åº¦
- é¢œè‰²ï¼šå¤æ™®æ¯”ç‡ / æ€»æ”¶ç›Š / èƒœç‡
- æ‰¾åˆ°å‚æ•°çš„"ç”œèœœåŒº"â€”â€”ç¨³å¥çš„åŒºåŸŸæ¯”æœ€ä¼˜ç‚¹æ›´é‡è¦

**å›¾è¡¨4ï¼šæ»šåŠ¨èƒœç‡ & ç›ˆäºæ¯”**
- Xè½´ï¼šæ—¶é—´
- åŒYè½´ï¼šæ»šåŠ¨20ç¬”èƒœç‡ + æ»šåŠ¨ç›ˆäºæ¯”
- æ´å¯Ÿï¼šç­–ç•¥æ˜¯å¦ç¨³å®šï¼Ÿæœ‰æ²¡æœ‰æŸæ®µæ—¶é—´çªç„¶å¤±æ•ˆï¼Ÿ

**ç»Ÿè®¡æ‘˜è¦è¡¨ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å›æµ‹åŒºé—´    2025-08 ~ 2026-02   â”‚
â”‚ æ€»äº¤æ˜“ç¬”æ•°  247                  â”‚
â”‚ èƒœç‡        56.3%               â”‚
â”‚ å¹³å‡ç›ˆåˆ©    8.2å…ƒ               â”‚
â”‚ å¹³å‡äºæŸ    -5.1å…ƒ              â”‚
â”‚ ç›ˆäºæ¯”      1.61                â”‚
â”‚ æœ€å¤§è¿èƒœ    7ç¬”                 â”‚
â”‚ æœ€å¤§è¿äº    4ç¬”                 â”‚
â”‚ æœ€å¤§å›æ’¤    -89å…ƒ (4.5%)        â”‚
â”‚ å¤æ™®æ¯”ç‡    1.82                â”‚
â”‚ æ—¥å‡äº¤æ˜“    2.1ç¬”               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### é¡µé¢å…­ï¼šç­–ç•¥å¥åº·åº¦

è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œç”¨è¿™ä¸ªé¡µé¢åˆ¤æ–­ç­–ç•¥æ˜¯å¦è¿˜"æ´»ç€"ã€‚

**å›¾è¡¨1ï¼šæ»šåŠ¨æŒ‡æ ‡è¶‹åŠ¿**
- å¤šçº¿å›¾ï¼šæ»šåŠ¨30ç¬”èƒœç‡ã€æ»šåŠ¨ç›ˆäºæ¯”ã€æ»šåŠ¨å¤æ™®æ¯”ç‡
- å åŠ è¶‹åŠ¿çº¿
- è®¾å®šå¥åº·é˜ˆå€¼ï¼ˆè™šçº¿ï¼‰ï¼Œä½äºé˜ˆå€¼åŒºåŸŸæ ‡çº¢
- æ´å¯Ÿï¼šç­–ç•¥åœ¨èµ°å¥½è¿˜æ˜¯èµ°å·®ï¼Ÿ

**å›¾è¡¨2ï¼šSpread ç‰¹æ€§æ¼‚ç§»æ£€æµ‹**
- å¯¹æ¯”æœ€è¿‘30å¤© vs å…¨å†å²çš„ spread ç»Ÿè®¡ç‰¹æ€§ï¼š
  - å‡å€¼æ˜¯å¦åç§»ï¼Ÿ
  - æ ‡å‡†å·®æ˜¯å¦å˜åŒ–ï¼Ÿ
  - å›å½’é€Ÿåº¦æ˜¯å¦å˜æ…¢ï¼Ÿ
- å¦‚æœ spread çš„ç»Ÿè®¡ç‰¹æ€§å‘ç”Ÿäº†ç»“æ„æ€§å˜åŒ–ï¼Œç­–ç•¥éœ€è¦é‡æ–°æ ‡å®šå‚æ•°

**å›¾è¡¨3ï¼šäº¤æ˜“é¢‘ç‡å˜åŒ–**
- æ¯æ—¥/æ¯å‘¨çš„ä¿¡å·æ•°é‡å’Œæˆäº¤æ•°é‡è¶‹åŠ¿
- é¢‘ç‡çªç„¶ä¸‹é™å¯èƒ½æ„å‘³ç€å¸‚åœºç¯å¢ƒå˜äº†ï¼ˆæ³¢åŠ¨ç‡é™ä½ã€spread æ”¶çª„ï¼‰

**å›¾è¡¨4ï¼šæ¨¡æ‹Ÿ vs å®ç›˜å¯¹æ¯”**ï¼ˆPhase 3 åå¯ç”¨ï¼‰
- åŒä¸€æ—¶æ®µçš„æ¨¡æ‹Ÿäº¤æ˜“ç»“æœ vs å®ç›˜äº¤æ˜“ç»“æœ
- å·®å¼‚åˆ†æï¼šæ»‘ç‚¹å®é™…æœ‰å¤šå¤§ï¼Ÿæ‰§è¡Œå»¶è¿Ÿå½±å“å¤šå°‘ï¼Ÿ
- æ´å¯Ÿï¼šæ¨¡æ‹Ÿå’Œå®ç›˜çš„å·®è·æ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Ÿ

---

#### Streamlit å®ç°è¦ç‚¹

**å¤šé¡µé¢ç»“æ„ï¼š**
```python
# app.py
import streamlit as st

pages = {
    "ç›˜ä¸­ç›‘æ§": "pages/dashboard.py",
    "äº¤æ˜“å¤ç›˜": "pages/trades.py",
    "Spread åˆ†æ": "pages/spread.py",
    "é£æ§é¢æ¿": "pages/risk.py",
    "å›æµ‹æŠ¥å‘Š": "pages/backtest.py",
    "ç­–ç•¥å¥åº·åº¦": "pages/health.py",
}
pg = st.navigation([st.Page(v, title=k) for k, v in pages.items()])
pg.run()
```

**æ•°æ®åŠ è½½æ¨¡å¼ï¼š**
```python
import sqlite3
import pandas as pd

@st.cache_data(ttl=10)  # ç›˜ä¸­é¡µé¢ï¼š10ç§’ç¼“å­˜
def load_today_trades(db_path):
    conn = sqlite3.connect(db_path)
    return pd.read_sql("SELECT * FROM trades WHERE date(timestamp) = date('now')", conn)

@st.cache_data(ttl=300)  # åˆ†æé¡µé¢ï¼š5åˆ†é’Ÿç¼“å­˜
def load_all_trades(db_path):
    conn = sqlite3.connect(db_path)
    return pd.read_sql("SELECT * FROM trades", conn)
```

**ç›˜ä¸­è‡ªåŠ¨åˆ·æ–°ï¼š**
```python
from streamlit_autorefresh import st_autorefresh
st_autorefresh(interval=10_000, key="dashboard_refresh")  # æ¯10ç§’
```

**å›¾è¡¨åº“é€‰æ‹©ï¼š**
- äº¤äº’å¼å›¾è¡¨ï¼šPlotlyï¼ˆæ‚¬æµ®ã€ç¼©æ”¾ã€æ¡†é€‰ï¼‰
- çƒ­åŠ›å›¾ï¼šPlotly Heatmap æˆ– Altair
- ç®€å•æŒ‡æ ‡ï¼š`st.metric`ï¼ˆå†…ç½®æ”¯æŒ delta ç®­å¤´ï¼‰
- è¡¨æ ¼ï¼š`st.dataframe`ï¼ˆå†…ç½®æ’åºç­›é€‰ï¼‰

---

## äº”ã€é£æ§ä¸‰å±‚é˜²çº¿

ä¸åˆ—å…·ä½“å‚æ•°ï¼ˆè¿™äº›åœ¨å›æµ‹åæ‰èƒ½ç¡®å®šï¼‰ï¼Œåªæè¿°é£æ§çš„å±‚æ¬¡ç»“æ„å’Œè®¾è®¡åŸåˆ™ã€‚

```
ç¬¬ä¸€å±‚ï¼šå•ç¬”çº§åˆ«
â”œâ”€â”€ å›ºå®šæ¯”ä¾‹æ­¢æŸï¼ˆäºX%ç«‹å³å¹³ä»“ï¼‰
â”œâ”€â”€ æ—¶é—´æ­¢æŸï¼ˆæŒä»“è¶…è¿‡Nåˆ†é’Ÿå¼ºåˆ¶å¹³ä»“ï¼‰
â””â”€â”€ å°¾ç›˜å¼ºåˆ¶å¹³ä»“ï¼ˆ14:50æ¸…ä»“ï¼Œä¸ç•™æ—¥å†…ä»“è¿‡å¤œï¼‰

ç¬¬äºŒå±‚ï¼šæ—¥å†…ç´¯ç§¯çº§åˆ«
â”œâ”€â”€ å•æ—¥æœ€å¤§äºæŸé¢ï¼ˆè§¦å‘åå½“æ—¥åœæ­¢äº¤æ˜“ï¼‰
â”œâ”€â”€ è¿ç»­äºæŸç¬”æ•°ï¼ˆè§¦å‘åå†·é™æœŸï¼‰
â””â”€â”€ å•æ—¥æœ€å¤§äº¤æ˜“ç¬”æ•°ï¼ˆé˜²æ­¢è¿‡åº¦äº¤æ˜“ï¼‰

ç¬¬ä¸‰å±‚ï¼šç­–ç•¥å¥åº·åº¦
â”œâ”€â”€ æ»šåŠ¨èƒœç‡ç›‘æ§ï¼ˆä½äºé˜ˆå€¼ç¼©ä»“æˆ–æš‚åœï¼‰
â”œâ”€â”€ åº•ä»“æµ®äºä¿æŠ¤ï¼ˆåº•ä»“äºæŸè¿‡å¤§æ—¶å‡ä»“æˆ–æ¸…ä»“ï¼‰
â””â”€â”€ æ€»äºæŸç†”æ–­çº¿ï¼ˆç­–ç•¥çº§åˆ«æ­¢æŸï¼Œè§¦å‘åæ°¸ä¹…åœæ­¢ï¼‰
```

**è®¾è®¡åŸåˆ™ï¼š**
- é£æ§è§„åˆ™ç¡¬ç¼–ç åœ¨æ‰§è¡Œæ¨¡å—ä¸­ï¼Œç­–ç•¥å¼•æ“æ— æ³•ç»•è¿‡
- æ¨¡æ‹Ÿäº¤æ˜“ä¹Ÿæ‰§è¡Œå®Œæ•´é£æ§é€»è¾‘ï¼ˆéªŒè¯é£æ§è§„åˆ™æœ¬èº«æ˜¯å¦åˆç†ï¼‰
- æ¯æ¬¡é£æ§è§¦å‘éƒ½å†™å…¥ `risk_events` è¡¨ï¼Œç›˜åå¯ä»¥åˆ†æ"é£æ§æ˜¯å¸®äº†ä½ è¿˜æ˜¯å®³äº†ä½ "
- å‚æ•°åˆæœŸä»å®½ï¼ˆé¿å…ç­–ç•¥è¿˜æ²¡è·‘èµ·æ¥å°±è¢«é£æ§å¡æ­»ï¼‰ï¼Œå›æµ‹åæ”¶ç´§

---

## å…­ã€å¼€å‘è·¯çº¿

### Phase 0ï¼šæ•°æ®æ¢ç´¢ä¸å›æµ‹ï¼ˆå½“å‰é˜¶æ®µï¼‰

> ç›®æ ‡ï¼šå›ç­”"æœŸè´§-ETFä»·å·®å›å½’æ˜¯å¦ç¨³å®šå­˜åœ¨"è¿™ä¸ªæ ¹æœ¬é—®é¢˜

```
Step 1  ä¸‹è½½æ•°æ®
        â”œâ”€â”€ client.download_futures_data()             # æœŸè´§å…ƒæ•°æ®
        â”œâ”€â”€ main = client.get_main_contract("AU.SHFE") # ä¸»åŠ›åˆçº¦ä»£ç 
        â”œâ”€â”€ client.download_batch([main], period="1m", start_time="20250801")
        â”œâ”€â”€ client.download_batch(["518880.SH"], period="1m", start_time="20250801")
        â”œâ”€â”€ au_df = client.get_history_ex([main], period="1m", start_time="20250801")
        â”œâ”€â”€ etf_df = client.get_history_ex(["518880.SH"], period="1m", start_time="20250801")
        â””â”€â”€ å­˜ä¸º Parquetï¼Œæ£€æŸ¥æ•°æ®è´¨é‡ï¼ˆç¼ºå€¼ã€æ—¶é—´å¯¹é½ï¼‰

Step 2  åˆ†æ spread ç‰¹å¾
        â”œâ”€â”€ è®¡ç®—æ¯æ—¥ spread = ETFæ—¥å†…æ¶¨è·Œå¹… - AUæ—¥å†…æ¶¨è·Œå¹…
        â”œâ”€â”€ ç»Ÿè®¡ spread çš„æ—¥å†…åˆ†å¸ƒï¼ˆæ˜¯å¦å›´ç»•0æ³¢åŠ¨ï¼Ÿæ ‡å‡†å·®å¤šå¤§ï¼Ÿï¼‰
        â”œâ”€â”€ åç¦»åçš„å›å½’é€Ÿåº¦ï¼ˆåç¦»1Ïƒåå¤šå°‘åˆ†é’Ÿå›å½’ï¼Ÿï¼‰
        â”œâ”€â”€ ä¸åŒæ—¶æ®µï¼ˆæ—©ç›˜/åˆç›˜ï¼‰ã€ä¸åŒå¸‚åœºç¯å¢ƒçš„è¡Œä¸ºå·®å¼‚
        â””â”€â”€ å¯è§†åŒ–è¾“å‡ºï¼ˆJupyter notebookï¼‰

Step 3  å›æµ‹æ¨¡æ‹Ÿ
        â”œâ”€â”€ ç”¨å†å²æ•°æ®è·‘ç­–ç•¥é€»è¾‘
        â”œâ”€â”€ ç»Ÿè®¡èƒœç‡ã€å¹³å‡ç›ˆäºæ¯”ã€æœ€å¤§è¿äºã€æ”¶ç›Šæ›²çº¿
        â”œâ”€â”€ å‚æ•°æ•æ„Ÿæ€§åˆ†æï¼ˆå“ªäº›å‚æ•°ç»„åˆæ¯”è¾ƒç¨³å¥ï¼‰
        â””â”€â”€ äº§å‡ºï¼šä¸€ä»½å›æµ‹æŠ¥å‘Š + åˆå§‹å‚æ•°é€‰æ‹©
```

**å†³ç­–ç‚¹ï¼š** å›æµ‹ç»“æœä¸ç†æƒ³ â†’ ç­–ç•¥åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸æµªè´¹æ—¶é—´å†™äº¤æ˜“ç³»ç»Ÿã€‚

### Phase 1ï¼šæ ¸å¿ƒç³»ç»Ÿæ­å»º

> å‰æï¼šPhase 0 å›æµ‹é€šè¿‡

```
Step 4  å®ç°æ•°æ®æ¨¡å—
        â””â”€â”€ å®æ—¶è®¢é˜… + æ»‘åŠ¨çª—å£ + æ•°æ®å¼‚å¸¸æ£€æµ‹

Step 5  å®ç°ç­–ç•¥å¼•æ“
        â””â”€â”€ spreadè®¡ç®— + Z-Scoreä¿¡å·ç”Ÿæˆ + åŸºç¡€é£æ§æ£€æŸ¥

Step 6  å®ç°æ‰§è¡Œæ¨¡å—ï¼ˆæ¨¡æ‹Ÿå¼•æ“ï¼‰
        â””â”€â”€ è™šæ‹Ÿè´¦æˆ· + æ¨¡æ‹Ÿæˆäº¤ + ç»Ÿä¸€æ¥å£

Step 7  å®ç°è®°å½•æ¨¡å—
        â””â”€â”€ SQLiteå»ºè¡¨ + è‡ªåŠ¨è®°å½•trades/signals/daily_summary

Step 8  å®ç°é€šçŸ¥æ¨¡å—ï¼ˆé£ä¹¦æœºå™¨äººï¼‰
        â”œâ”€â”€ FeishuNotifier ç±»ï¼ˆWebhook POSTï¼Œæ”¯æŒç­¾åï¼‰
        â”œâ”€â”€ æ¥å…¥ç‚¹ï¼šæˆäº¤åé€šçŸ¥ã€é£æ§è§¦å‘é€šçŸ¥ã€æ”¶ç›˜æ±‡æ€»é€šçŸ¥ã€å¼‚å¸¸å‘Šè­¦
        â””â”€â”€ é˜²åˆ·æ§åˆ¶ï¼ˆåŒç±»é€šçŸ¥æœ€çŸ­é—´éš”ã€æ¯æ—¥ä¸Šé™ï¼‰

Step 9  å®ç°å¯è§†åŒ–ä»ªè¡¨ç›˜ï¼ˆStreamlitï¼‰
        â”œâ”€â”€ ç›˜ä¸­ç›‘æ§é¡µï¼šSpreadå®æ—¶å›¾ã€æŒä»“çŠ¶æ€ã€ä¿¡å·åˆ—è¡¨
        â”œâ”€â”€ äº¤æ˜“å¤ç›˜é¡µï¼šPnLæ›²çº¿ã€äº¤æ˜“æ˜ç»†è¡¨ã€ç›ˆäºåˆ†å¸ƒ
        â”œâ”€â”€ Spreadåˆ†æé¡µï¼šåˆ†æ—¶çƒ­åŠ›å›¾ã€åˆ†å¸ƒç›´æ–¹å›¾ã€å›å½’é€Ÿåº¦
        â”œâ”€â”€ é£æ§é¢æ¿é¡µï¼šé£æ§äº‹ä»¶æ—¶é—´çº¿ã€ä¿¡å·è¿‡æ»¤åˆ†æ
        â””â”€â”€ å›æµ‹æŠ¥å‘Šé¡µï¼ˆå¯¹æ¥Phase 0å›æµ‹ç»“æœï¼‰

Step 10 é›†æˆæµ‹è¯•
        â””â”€â”€ æ¨¡æ‹Ÿæ¨¡å¼ç«¯åˆ°ç«¯è·‘é€šï¼šè¡Œæƒ…â†’ä¿¡å·â†’æ¨¡æ‹Ÿæˆäº¤â†’è®°å½•â†’é£ä¹¦é€šçŸ¥â†’ä»ªè¡¨ç›˜å¯è§
```

### Phase 2ï¼šæ¨¡æ‹Ÿäº¤æ˜“éªŒè¯

> ç”¨æ¨¡æ‹Ÿå¼•æ“è·‘å®ç›˜è¡Œæƒ…ï¼Œä¸æŠ•å…¥çœŸé‡‘ç™½é“¶

```
Step 11  æ¨¡æ‹Ÿè¿è¡Œ2-4å‘¨ï¼ˆæ¯å¤©å¼€ç›˜å¯åŠ¨ç³»ç»Ÿï¼Œé£ä¹¦é€šçŸ¥ + Streamlit ç›‘æ§ï¼‰
Step 12  å¯¹æ¯”åˆ†æï¼ˆæ¨¡æ‹Ÿ vs å›æµ‹åå·®ã€ä¿¡å·é¢‘ç‡ã€é£æ§åˆç†æ€§ï¼‰
         â””â”€â”€ ä½¿ç”¨ç­–ç•¥å¥åº·åº¦é¡µé¢è¯„ä¼°ç­–ç•¥ç¨³å®šæ€§
```

**å†³ç­–ç‚¹ï¼š** æ¨¡æ‹Ÿèƒœç‡è¾¾æ ‡ â†’ åˆ‡æ¢å®ç›˜ï¼›ä¸è¾¾æ ‡ â†’ è°ƒæ•´å‚æ•°é‡æ–°æ¨¡æ‹Ÿï¼Œæˆ–æ”¾å¼ƒã€‚

### Phase 3ï¼šå®ç›˜äº¤æ˜“

```
Step 13  å®ç° LiveEngineï¼ˆå¯¹æ¥ QMTClient äº¤æ˜“æ¥å£ + æˆäº¤å›æŠ¥å¤„ç†ï¼‰
Step 14  åˆ‡æ¢å®ç›˜ï¼ˆåˆ†æ‰¹å»ºåº•ä»“ â†’ ä¿å®ˆè¿è¡Œ â†’ é€æ­¥æ”¾å¼€ï¼‰
Step 15  æŒç»­è¿­ä»£ï¼ˆæ¯å‘¨å¤ç›˜ã€æ¯æœˆå‚æ•°æ£€æŸ¥ï¼‰
         â””â”€â”€ å¯ç”¨"æ¨¡æ‹Ÿ vs å®ç›˜å¯¹æ¯”"é¡µé¢ï¼Œç›‘æ§æ‰§è¡Œå·®å¼‚
```

---

## ä¸ƒã€æŠ€æœ¯æ ˆ

```
ç­–ç•¥é¡¹ç›®ï¼šPythonï¼ˆç‹¬ç«‹é¡¹ç›®ï¼Œpip install qmt-bridge å¼•å…¥å®¢æˆ·ç«¯ï¼‰

æ•°æ®è·å–ï¼šqmt-bridge QMTClient
  â”œâ”€â”€ subscribe_realtime â†’ å®æ—¶è¡Œæƒ…ï¼ˆWebSocketï¼‰
  â”œâ”€â”€ get_history_ex â†’ å†å²Kçº¿ï¼ˆRESTï¼‰
  â”œâ”€â”€ get_market_snapshot â†’ å®æ—¶å¿«ç…§ï¼ˆRESTï¼‰
  â””â”€â”€ get_main_contract â†’ ä¸»åŠ›åˆçº¦æŸ¥è¯¢ï¼ˆRESTï¼‰

äº¤æ˜“æ‰§è¡Œï¼šqmt-bridge QMTClient
  â”œâ”€â”€ place_order / place_order_async â†’ ä¸‹å•
  â”œâ”€â”€ cancel_order â†’ æ’¤å•
  â”œâ”€â”€ query_positions / query_asset â†’ æŸ¥è¯¢
  â””â”€â”€ subscribe_trade_events â†’ æˆäº¤å›æŠ¥ï¼ˆWebSocketï¼‰

æ•°æ®å­˜å‚¨ï¼š
  â”œâ”€â”€ SQLite â†’ äº¤æ˜“æ—¥å¿—ã€ä¿¡å·è®°å½•ã€é£æ§äº‹ä»¶
  â””â”€â”€ Parquet â†’ å†å²Kçº¿ï¼ˆå›æµ‹ç”¨ï¼‰

é€šçŸ¥æ¨é€ï¼šé£ä¹¦è‡ªå®šä¹‰æœºå™¨äºº Webhook
  â”œâ”€â”€ é›¶ä¾èµ–ï¼ˆstdlib urllib.requestï¼‰
  â”œâ”€â”€ æ”¯æŒ v2 ç­¾åæ ¡éªŒ
  â””â”€â”€ äº¤æ˜“é€šçŸ¥ / é£æ§å‘Šè­¦ / æ¯æ—¥æŠ¥å‘Š / ç³»ç»Ÿå¼‚å¸¸

æ•°æ®åˆ†æï¼špandas + numpy

å¯è§†åŒ–ä»ªè¡¨ç›˜ï¼šStreamlit
  â”œâ”€â”€ streamlit â†’ å¤šé¡µé¢åº”ç”¨æ¡†æ¶
  â”œâ”€â”€ plotly â†’ äº¤äº’å¼å›¾è¡¨ï¼ˆæ‚¬æµ®ã€ç¼©æ”¾ã€æ¡†é€‰ï¼‰
  â””â”€â”€ streamlit-autorefresh â†’ ç›˜ä¸­è‡ªåŠ¨åˆ·æ–°

è·¨å¹³å°ï¼šqmt-bridge (å·²æœ‰) â†’ Mac â†” Windows QMT
```

---

## å…«ã€æ–‡ä»¶ç»“æ„

```
gold-etf-strategy/
â”œâ”€â”€ pyproject.toml             # ä¾èµ–ï¼šqmt-bridge, pandas, numpy
â”œâ”€â”€ config.py                  # è¿è¡Œæ¨¡å¼ã€QMTè¿æ¥ä¿¡æ¯ã€ç­–ç•¥å‚æ•°
â”œâ”€â”€ main.py                    # å¯åŠ¨å…¥å£ï¼ˆ--mode simulated/liveï¼‰
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ feed.py                # QMTClient å®æ—¶è®¢é˜…ä¸åˆ†å‘
â”‚   â””â”€â”€ history.py             # å†å²æ•°æ®ä¸‹è½½ã€Parquet ç®¡ç†
â”‚
â”œâ”€â”€ strategy/
â”‚   â”œâ”€â”€ spread.py              # spread / z-score è®¡ç®—
â”‚   â””â”€â”€ signal.py              # ä¿¡å·ç”Ÿæˆé€»è¾‘
â”‚
â”œâ”€â”€ execution/
â”‚   â”œâ”€â”€ base.py                # ExecutionEngine æŠ½è±¡æ¥å£
â”‚   â”œâ”€â”€ simulated.py           # æ¨¡æ‹Ÿäº¤æ˜“å¼•æ“
â”‚   â””â”€â”€ live.py                # å®ç›˜äº¤æ˜“å¼•æ“ï¼ˆPhase 3ï¼‰
â”‚
â”œâ”€â”€ risk/
â”‚   â””â”€â”€ manager.py             # ä¸‰å±‚é£æ§è§„åˆ™
â”‚
â”œâ”€â”€ notifier/
â”‚   â””â”€â”€ feishu.py              # é£ä¹¦æœºå™¨äººé€šçŸ¥ï¼ˆäº¤æ˜“/é£æ§/æ—¥æŠ¥/å¼‚å¸¸ï¼‰
â”‚
â”œâ”€â”€ recorder/
â”‚   â”œâ”€â”€ db.py                  # SQLite å»ºè¡¨ä¸å†™å…¥
â”‚   â””â”€â”€ models.py              # Trade, Signal, DailySummary æ•°æ®ç±»
â”‚
â”œâ”€â”€ backtest/
â”‚   â”œâ”€â”€ runner.py              # å›æµ‹å¼•æ“
â”‚   â””â”€â”€ analysis.py            # å›æµ‹ç»“æœåˆ†æä¸å¯è§†åŒ–
â”‚
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ app.py                 # Streamlit å…¥å£ï¼ˆå¤šé¡µé¢å¯¼èˆªï¼‰
â”‚   â””â”€â”€ pages/
â”‚       â”œâ”€â”€ dashboard.py       # ç›˜ä¸­ç›‘æ§ï¼ˆSpreadå®æ—¶ã€æŒä»“ã€ä¿¡å·ï¼‰
â”‚       â”œâ”€â”€ trades.py          # äº¤æ˜“å¤ç›˜ï¼ˆPnLæ›²çº¿ã€æ˜ç»†è¡¨ã€åˆ†å¸ƒå›¾ï¼‰
â”‚       â”œâ”€â”€ spread.py          # Spreadæ·±åº¦åˆ†æï¼ˆçƒ­åŠ›å›¾ã€ACFã€å›å½’é€Ÿåº¦ï¼‰
â”‚       â”œâ”€â”€ risk.py            # é£æ§é¢æ¿ï¼ˆäº‹ä»¶æ—¶é—´çº¿ã€ä¿¡å·è¿‡æ»¤åˆ†æï¼‰
â”‚       â”œâ”€â”€ backtest.py        # å›æµ‹æŠ¥å‘Šï¼ˆå‚æ•°æ•æ„Ÿæ€§ã€æƒç›Šæ›²çº¿ï¼‰
â”‚       â””â”€â”€ health.py          # ç­–ç•¥å¥åº·åº¦ï¼ˆæ¼‚ç§»æ£€æµ‹ã€æ»šåŠ¨æŒ‡æ ‡ï¼‰
â”‚
â”œâ”€â”€ storage/
â”‚   â”œâ”€â”€ history/               # Parquet å†å²Kçº¿
â”‚   â””â”€â”€ trades.db              # SQLite äº¤æ˜“æ•°æ®åº“
â”‚
â””â”€â”€ notebooks/
    â””â”€â”€ spread_analysis.ipynb  # Phase 0 æ•°æ®æ¢ç´¢
```

---

## ä¹ã€qmt-bridge å…³é”®æ¥å£é€ŸæŸ¥

ç­–ç•¥å¼€å‘ä¸­æœ€å¸¸ç”¨çš„ QMTClient è°ƒç”¨æ±‡æ€»ï¼š

```python
from qmt_bridge import QMTClient

client = QMTClient("192.168.x.x", port=8000, api_key="xxx")

# â”€â”€ æ•°æ® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# ä¸»åŠ›åˆçº¦
client.get_main_contract("AU.SHFE")

# ä¸‹è½½å†å²æ•°æ®ï¼ˆæœåŠ¡ç«¯ç¼“å­˜ï¼‰
client.download_futures_data()
client.download_batch(["518880.SH"], period="1m", start_time="20250801", end_time="20260211")

# è¯»å–å†å²Kçº¿ï¼ˆè¿”å› {stock: DataFrame}ï¼‰
client.get_history_ex(["518880.SH"], period="1m", start_time="20250801")
client.get_history_ex(["AU2506.SHFE"], period="1m", start_time="20250801")

# å®æ—¶å¿«ç…§
client.get_market_snapshot(["518880.SH", "AU2506.SHFE"])

# å®æ—¶è®¢é˜…ï¼ˆWebSocketï¼Œå¼‚æ­¥ï¼‰
await client.subscribe_realtime(["518880.SH", "AU2506.SHFE"], callback=on_tick, period="tick")

# â”€â”€ äº¤æ˜“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# ä¸‹å•ï¼ˆé™ä»·ä¹°å…¥100è‚¡ï¼‰
client.place_order(stock_code="518880.SH", order_type=23, order_volume=100, price_type=11, price=6.50, strategy_name="gold_etf_swing")

# æ’¤å•
client.cancel_order(order_id=12345)

# æŸ¥æŒä»“
client.query_positions()
client.query_single_position("518880.SH")

# æŸ¥ä½™é¢
client.query_asset()

# æŸ¥æˆäº¤
client.query_trades()

# æˆäº¤å›æŠ¥è®¢é˜…ï¼ˆWebSocketï¼Œå¼‚æ­¥ï¼‰
await client.subscribe_trade_events(callback=on_trade)

# â”€â”€ è¾…åŠ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# äº¤æ˜“æ—¥å†
client.is_trading_date("SH", "20260211")
client.get_trading_dates("SH", start_time="20260101", end_time="20260301")
client.get_trading_period("518880.SH")
client.get_holidays()

# åˆçº¦ä¿¡æ¯
client.get_batch_instrument_detail(["AU2506.SHFE", "518880.SH"])
```

---

## åã€ç¬¬ä¸€æ­¥è¡ŒåŠ¨

**ç°åœ¨å¯ä»¥å¼€å§‹ï¼šPhase 0 Â· Step 1 + Step 2**

1. é€šè¿‡ QMTClient ä¸‹è½½ AUä¸»åŠ›åˆçº¦å’Œ 518880 æœ€è¿‘6ä¸ªæœˆçš„1åˆ†é’ŸKçº¿æ•°æ®
2. è®¡ç®—æ¯æ—¥çš„ spread åºåˆ—
3. ç”»å›¾çœ‹çœ‹ spread çš„åˆ†å¸ƒå’Œå›å½’ç‰¹å¾

è¿™ä¸€æ­¥å®Œæˆåï¼Œå°±èƒ½åˆ¤æ–­åé¢è¿˜å€¼ä¸å€¼å¾—ç»§ç»­åšã€‚

**qmt-bridge æœ¬èº«ä¸éœ€è¦ä»»ä½•ä¿®æ”¹ã€‚**
